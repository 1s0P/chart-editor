<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>4レーン譜面エディタ (内部96分固定)</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    .toolbar { position: sticky; top: 0; background: #eee; padding: 5px; display: flex; align-items: center; gap: 8px; z-index: 10; }
    .main { display: flex; }
    canvas { background: #fff; cursor: crosshair; }
    .sidebar { width: 220px; padding: 10px; background: #f9f9f9; font-size: 14px; line-height: 1.4; }
    label, select, input, button { font-size: 14px; }

    .mode-bar input[type="radio"] { display: none; }
    .mode-bar label { display: inline-block; border: 2px solid transparent; border-radius: 6px; padding: 2px; margin: 2px; }
    .mode-bar img { width: 32px; height: 32px; cursor: pointer; opacity: .6; transition: opacity .2s; }
    .mode-bar input[type="radio"]:checked + img { opacity: 1; border: 2px solid #4caf50; border-radius: 6px; }

  </style>
</head>
<body>
  <div class="toolbar">
    <div class="mode-bar">
      <label>
        <input type="radio" name="mode" value="tap" checked />
        <img src="icons/Tap.png" alt="Tap" title="Tap (C1–F1)" />
      </label>
      <label>
        <input type="radio" name="mode" value="long" />
        <img src="icons/Hold.png" alt="Hold" title="Hold (C2–F2)" />
      </label>
      <label>
        <input type="radio" name="mode" value="tick" />
        <img src="icons/Tick.png" alt="Tick" title="Tick (C3–F3)" />
      </label>
      <label>
        <input type="radio" name="mode" value="select" />
        <img src="icons/select.png" alt="Select" title="Select/範囲選択" />
      </label>
      <label>
        <input type="radio" name="mode" value="fxTap" />
        <img src="icons/FX_Tap.png" alt="FX Tap" title="FX Tap (C4–F4)" />
      </label>
      <label>
        <input type="radio" name="mode" value="fxLong" />
        <img src="icons/FX_Hold.png" alt="FX Hold" title="FX Hold (C5–F5)" />
      </label>
      <label>
        <input type="radio" name="mode" value="slashfx" />
        <img src="icons/SLASHFX_L.png" alt="SLASH FX" title="SLASH FX (C7/F7) 端レーン限定" />
      </label>
      <label>Lane Mode:
  <select id="laneMode">
    <option value="4" selected>4</option>
    <option value="8">8</option>
  </select>
</label>
    </div>

    <button id="copyBtn" disabled>コピー</button>
    <button id="pasteBtn" disabled>ペースト</button>
    <button id="mirrorPasteBtn" disabled>左右反転貼り付け</button>
    <button id="deleteBtn" disabled>削除</button>
    <button id="flipBtn" disabled>左右反転</button>

    <label>Placement Unit:
      <select id="unitSelect">
        <option value="16">1/16</option>
        <option value="24">1/24</option>
        <option value="32">1/32</option>
        <option value="48">1/48</option>
        <option value="96">1/96</option>
      </select>
    </label>
    <label>Measures: <input type="number" id="measureCount" value="4" min="1" style="width:50px;" /></label>
    <label>Lane Height: <input type="range" id="laneHeight" min="20" max="60" value="20" /></label>
    <label>BPM: <input type="number" id="bpm" value="120" style="width:60px;" /></label>
    <button id="exportMidi">Export MIDI</button>
    <label>Import MIDI: <input type="file" id="importMidi" accept=".mid" /></label>
  </div>

  <div class="main">
    <canvas id="editor"></canvas>
    <div class="sidebar">
      <strong>操作説明</strong><br>
      • Tap: 左クリックでタップ配置（緑）<br>
      • Hold: 左クリック2回でロング配置（青。4分未満でも可）<br>
      • Tick: 左ドラッグで連続配置（黄色）<br>
      • FX Tap: 赤（仕様はTapと同じ）<br>
      • FX Hold: 赤系ロング（仕様はHoldと同じ）<br>
      • SLASH FX: 左端(C7/赤)・右端(F7/青)のみ配置可、ジグザグ描画<br>
      • Select: 範囲選択→ Copy/Paste/Delete/Flip/Mirror Paste<br>
      • ショートカット: Ctrl+C / Ctrl+V / Delete<br>
      • 右ドラッグ: 消しゴム（Select以外のモードで有効）
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/midi-writer-js/browser/midiwriter.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tonejs/midi/build/Midi.min.js"></script>
<script type="module" src="./src/controller.js"></script>

</body>
</html>
